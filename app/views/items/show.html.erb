<% if @item.item_delete_flag_before_type_cast == 0 %>

<div class="container">
	<div class="row3 clearfix">
		<h1>商品詳細</h1>
		<div class="col-md-5">
	    <%= attachment_image_tag @item, :item_image, :fill, 350, 350, fallback: "no_image.jpg", size:'350x350' %>
		</div>
		<div class="col-md-7">
			<h3>アルバム名：<%= @item.item_name %></h3>
			<h3>アーティスト名：<%= @item.artist.artist_name %></h3>
			<table border="2">
            	<tr>
                	<th style="font-weight: bold;">発売日</th>
                	<th><%= @item.item_release_date.strftime('%y/%m/%d') %></th>
		    	</tr>
		    	<tr>
                	<th style="font-weight: bold;">レーベル</th>
                	<th><%= @item.label.label_name %></th>
		    	</tr>
		    	<tr>
                	<th style="font-weight: bold;">ジャンル</th>
                	<th><%= @item.genre.genre_name %></th>
		    	</tr>
		    	<tr>
                	<th style="font-weight: bold;">価格</th>
                	<th><%= (@item.item_price*1.1).round(0) %>円(税込)</th>
		    	</tr>
		    </table>
		    <% if @arrivals_sum - @order_items_sum > 0 %>
		    <div class="cart-content">
				<%= form_for(@cart, url: cart_path(@item)) do |f| %>
				<p><%= f.number_field :cart_item_number, min: "1", :style=>"width: 30px;" %>枚</p>
				<p><%= f.hidden_field :item_id, value:@item.id %></p>
				<%= f.submit 'カートへ追加' %>
				<% end %>
			</div>
			<% else %>
			   <div class="sales-status">売り切れ</div>
			<% end %>
		</div>
	</div>

	<div class="wrap">
	    <ul id="tab-menu">
			<li><a href="#tab1" class="active">収録曲一覧</a></li>
			<li><a href="#tab2" class="b">レビュー一覧</a></li>
		</ul>
      	<div id="tab-contents" class="clearfix">
	        <div id="tab1" class="tab">
				<div class="dics-container">
				<% @item.discs.each do |d| %>
					<h3><%= "#{d.disc_name}" %></h3>
					<div class="songs-container clearfix">
					<% d.songs.each.with_index(1) do |s, i| %>
						<p><%= "#{i}.""#{s.song}"%></p>
					<% end %>
					</div>
				<% end %>
				</div>
	        </div>

	        <div id="tab2" class="tab">
				<div class ="review-headline clearfix">
				  	<h4>レビュー平均：</h4>
				  	<% if @satisfaction_average.nil? %>
					<div id="star-average">※レビューはございません</div>
					<% else %>
				  	<div id="star-average"><%= @satisfaction_average.round(2) %></div>
				  	<% end %>
					<div id="star-rate"></div>
			          <script>
				          $('#star-rate').raty({
				            size: 200,
				            starOff:  '<%= ('star-off.png') %>',
				            starOn : '<%= ('star-on.png') %>',
				            starHalf: '<%= ('star-half.png') %>',
				            half: true,
				            readOnly: true,
				            score: <%= @satisfaction_average %>,
				          });
				      </script>
					<h5><%= @satisfaction_count %>件</h5>
				</div>
				<% @reviews.each.with_index(1) do |r,i| %>
				<div class="reviews-container clearfix">
					<h4><%= "#{i}. " %><%= r.review_title %></h4>
					<div id="star-number"><%= r.satisfaction %></div>
					<div id="star-rate-<%= r.id %>"></div>
			          <script>
			          $('#star-rate-<%= r.id %>').raty({
			            size: 36,
			            starOff:  '<%= ('star-off.png') %>',
			            starOn : '<%= ('star-on.png') %>',
			            starHalf: '<%= ('star-half.png') %>',
			            half: true,
			            readOnly: true,
			            score: <%= r.satisfaction %>,
			          });
			          </script>
					<h6><%= r.review_content %></h6>
					<h6>投稿者：<%= r.user.name_family_kanji + r.user.name_first_kanji %> /
					   投稿日：<%= r.created_at.strftime('%y/%m/%d') %></h6>
				</div>
				<% end %>
				<%= paginate @reviews %></div>
			</div>
    	</div>
    </div>
    <p style="margin: 0 auto; width: 200px;"> <%= link_to "商品一覧へ戻る", root_path %> </p>
</div>
	<!-- タブ用javascript -->
		<script>
			var urlParam = window.location.search.substring(1);
			if(urlParam) {
			$("#tab-menu .active").removeClass("active");
			$("#tab-menu .b").addClass("active");
			$('#tab-contents .tab[id = "tab1"]').hide();
			$('#tab-menu a').on('click', function() {
			  $("#tab-contents .tab").hide();
			  $("#tab-menu .active").removeClass("active");
			  $(this).addClass("active");
			  $($(this).attr("href")).show();
			  return false;
			});
			} else {
			$('#tab-contents .tab[id != "tab1"]').hide();
			$('#tab-menu a').on('click', function() {
			  $("#tab-contents .tab").hide();
			  $("#tab-menu .active").removeClass("active");
			  $(this).addClass("active");
			  $($(this).attr("href")).show();
			  return false;
			});
			};
		</script>
<% else %>
<P> 現在、ご覧いただいている商品は販売停止中です。 </P>
<P> <%= link_to "商品一覧へ戻る", root_path %> </P>
<% end %>